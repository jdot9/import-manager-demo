import { isNodeModule } from "../utils.js";
const relevantModules = {};
export function getRelevantModules(output) {
    return relevantModules[output] || [];
}
const relevantModulesPlugin = ({ output, logger }) => {
    return {
        name: 'ui-extensions-relevant-modules-plugin',
        generateBundle(_options, bundle) {
            const subBundle = bundle[output];
            if (!subBundle || !subBundle.moduleIds) {
                // If this happens, something has gone horribly wrong
                logger.error('Invalid bundle format, please try saving the extension again.  If the problem persists try restarting `hs project dev`');
                return;
            }
            const updatedRelevantModules = subBundle.moduleIds.filter((moduleId) => !isNodeModule(moduleId));
            if (updatedRelevantModules.length === 0) {
                logger.error('Unable to determine relevant files to watch, please try saving the extension again. If the problem persists try restarting `hs project dev`');
                return;
            }
            relevantModules[output] = updatedRelevantModules;
        },
    };
};
export default relevantModulesPlugin;
