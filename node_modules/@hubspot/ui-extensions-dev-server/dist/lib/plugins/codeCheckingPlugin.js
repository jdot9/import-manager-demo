import fs from 'fs';
const codeCheckingPlugin = (options) => {
    const { output, logger } = options;
    return {
        name: 'ui-extensions-code-checking-plugin',
        enforce: 'post',
        writeBundle() {
            try {
                const code = fs.readFileSync(output).toString();
                if (
                // These checks are for older versions of our library
                !code.includes('const extend = (...args) => self.extend(...args);') &&
                    !code.includes('self.extend_V2(renderExtensionCallback)') &&
                    // This is for version 0.11.3+ of our library where we changed the worker globals function name
                    !code.includes('getWorkerGlobals().extend_V2')) {
                    logger.warn('Unable to determine if your extension entry point is calling hubspot.extend, this may prevent it from rendering as expected');
                }
            }
            catch (e) {
                logger.error('Unable to load bundle for code checking');
            }
        },
    };
};
export default codeCheckingPlugin;
