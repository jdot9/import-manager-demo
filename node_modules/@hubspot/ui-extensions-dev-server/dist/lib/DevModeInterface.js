import { SUPPORTED_APP_TYPES, PUBLIC_APP } from "./constants.js";
import { loadExtensionConfig } from "./config.js";
import { DevModeParentInterface } from "./DevModeParentInterface.js";
class DevModeInterface extends DevModeParentInterface {
    _generateAppExtensionMappings(components) {
        // Loop over all of the app configs that are passed in
        const allComponentNames = Object.keys(components);
        return allComponentNames.reduce((appExtensionMappings, componentName) => {
            const component = components[componentName];
            if (!SUPPORTED_APP_TYPES.includes(component.type)) {
                return appExtensionMappings; // It's not a modern app, skip it
            }
            // Load all of the extension configs for a particular app.json file
            const extensionsConfigForApp = loadExtensionConfig(component.config, component.path);
            const extensionConfigKeys = Object.keys(extensionsConfigForApp);
            // Loop over the loaded extension configs and generate the list of choices to use to prompt the user for input
            extensionConfigKeys.forEach((extensionKey) => {
                const extensionConfig = extensionsConfigForApp[extensionKey];
                if (extensionConfig.appConfig) {
                    extensionConfig.appConfig.isPublicApp = component.type === PUBLIC_APP;
                }
                appExtensionMappings.push({
                    name: `${componentName}/${extensionConfig.data.title}`,
                    value: extensionConfig,
                });
            });
            return appExtensionMappings;
        }, []);
    }
    async setup(args) {
        args.choices = this._generateAppExtensionMappings(args.components);
        await this.parentSetup(args);
    }
}
export { DevModeInterface as DevModeInterfaceNonSingleton };
export default new DevModeInterface();
