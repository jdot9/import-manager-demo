import { renameConfigAccount } from '@hubspot/local-dev-lib/config';
import { trackCommandUsage } from '../../lib/usageTracking.js';
import { commands } from '../../lang/en.js';
import { uiLogger } from '../../lib/ui/logger.js';
import { logError } from '../../lib/errorHandlers/index.js';
import { EXIT_CODES } from '../../lib/enums/exitCodes.js';
import { makeYargsBuilder } from '../../lib/yargsUtils.js';
import { toKebabCase } from '@hubspot/local-dev-lib/text';
const command = 'rename <account-name> <new-name>';
const describe = commands.account.subcommands.rename.describe;
async function handler(args) {
    const { accountName, newName, derivedAccountId } = args;
    trackCommandUsage('accounts-rename', undefined, derivedAccountId);
    const newNameKebabCase = toKebabCase(newName);
    const nameWasSanitized = newNameKebabCase !== newName;
    try {
        renameConfigAccount(accountName, newNameKebabCase);
    }
    catch (error) {
        logError(error);
        process.exit(EXIT_CODES.ERROR);
    }
    uiLogger.success(commands.account.subcommands.rename.success.renamed(accountName, newNameKebabCase, nameWasSanitized));
    process.exit(EXIT_CODES.SUCCESS);
}
function accountRenameBuilder(yargs) {
    yargs.positional('account-name', {
        describe: commands.account.subcommands.rename.positionals.accountName.describe,
        type: 'string',
    });
    yargs.positional('new-name', {
        describe: commands.account.subcommands.rename.positionals.newName.describe,
        type: 'string',
    });
    yargs.example([
        ['$0 accounts rename myExistingAccountName myNewAccountName'],
    ]);
    return yargs;
}
const builder = makeYargsBuilder(accountRenameBuilder, command, describe, {
    useGlobalOptions: true,
    useConfigOptions: true,
    useAccountOptions: true,
});
const accountRenameCommand = {
    command,
    describe,
    handler,
    builder,
};
export default accountRenameCommand;
