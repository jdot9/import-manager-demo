import { promptUser } from './promptUtils.js';
import { lib } from '../../lang/en.js';
import { uiAccountDescription } from '../ui/index.js';
import { HUBSPOT_ACCOUNT_TYPES } from '@hubspot/local-dev-lib/constants/config';
import { isSandbox } from '../accountTypes.js';
import { getConfigDefaultAccountIfExists, getAllConfigAccounts, } from '@hubspot/local-dev-lib/config';
function mapSandboxAccountChoices(portals) {
    return (portals
        ?.filter(p => isSandbox(p))
        .map(p => ({
        name: uiAccountDescription(p.accountId, false),
        value: p.accountId,
    })) || []);
}
function mapNonSandboxAccountChoices(portals) {
    return (portals
        ?.filter(p => !isSandbox(p))
        .map(p => ({
        name: `${p.name} (${p.accountId})`,
        value: p.accountId,
    })) || []);
}
export async function sandboxTypePrompt() {
    return promptUser([
        {
            name: 'type',
            message: lib.prompts.sandboxesPrompt.type.message,
            type: 'list',
            choices: [
                {
                    name: lib.prompts.sandboxesPrompt.type.developer,
                    value: HUBSPOT_ACCOUNT_TYPES.DEVELOPMENT_SANDBOX,
                },
                {
                    name: lib.prompts.sandboxesPrompt.type.standard,
                    value: HUBSPOT_ACCOUNT_TYPES.STANDARD_SANDBOX,
                },
            ],
            default: HUBSPOT_ACCOUNT_TYPES.DEVELOPMENT_SANDBOX,
        },
    ]);
}
export function deleteSandboxPrompt(promptParentAccount = false) {
    const accountsList = getAllConfigAccounts();
    const choices = promptParentAccount
        ? mapNonSandboxAccountChoices(accountsList)
        : mapSandboxAccountChoices(accountsList);
    if (!choices.length) {
        return Promise.resolve(undefined);
    }
    return promptUser([
        {
            name: 'account',
            message: promptParentAccount
                ? lib.prompts.sandboxesPrompt.selectParentAccountName
                : lib.prompts.sandboxesPrompt.selectAccountName,
            type: 'list',
            pageSize: 20,
            choices,
            default: getConfigDefaultAccountIfExists()?.accountId,
        },
    ]);
}
