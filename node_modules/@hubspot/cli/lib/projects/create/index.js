import { selectProjectTemplatePrompt, } from '../../prompts/selectProjectTemplatePrompt.js';
import { projectNameAndDestPrompt } from '../../prompts/projectNameAndDestPrompt.js';
import { DEFAULT_PROJECT_TEMPLATE_BRANCH, HUBSPOT_PROJECT_COMPONENTS_GITHUB_PATH, EMPTY_PROJECT, } from '../../constants.js';
import { isV2Project } from '../platformVersion.js';
import { v2ComponentFlow } from './v2.js';
import { getProjectTemplateListFromRepo } from './legacy.js';
import { uiLogger } from '../../ui/logger.js';
import { commands } from '../../../lang/en.js';
import { EXIT_CODES } from '../../enums/exitCodes.js';
export async function handleProjectCreationFlow(args) {
    const { platformVersion, templateSource, projectBase, auth: providedAuth, distribution: providedDistribution, } = args;
    const repo = templateSource || HUBSPOT_PROJECT_COMPONENTS_GITHUB_PATH;
    const projectNameAndDestPromptResponse = await projectNameAndDestPrompt(args);
    if (isV2Project(platformVersion)) {
        const { componentTemplateChoices, authType, distribution, repoConfig, projectContents, } = await v2ComponentFlow(platformVersion, projectBase, providedAuth, providedDistribution, args.derivedAccountId);
        const selectProjectTemplatePromptResponse = await selectProjectTemplatePrompt(args, undefined, projectContents !== EMPTY_PROJECT ? componentTemplateChoices : undefined);
        return {
            authType,
            distribution,
            repoConfig,
            projectContents,
            selectProjectTemplatePromptResponse,
            projectNameAndDestPromptResponse,
        };
    }
    const projectTemplates = await getProjectTemplateListFromRepo(repo, DEFAULT_PROJECT_TEMPLATE_BRANCH);
    if (!projectTemplates.length) {
        uiLogger.error(commands.project.create.errors.failedToFetchProjectList);
        process.exit(EXIT_CODES.ERROR);
    }
    const selectProjectTemplatePromptResponse = await selectProjectTemplatePrompt(args, projectTemplates);
    return {
        selectProjectTemplatePromptResponse,
        projectNameAndDestPromptResponse,
    };
}
