"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.addOauthToAccountConfig = exports.getOauthManager = void 0;
const OAuth2Manager_1 = require("../models/OAuth2Manager");
const logger_1 = require("./logger");
const config_1 = require("../config");
const lang_1 = require("../utils/lang");
const i18nKey = 'lib.oauth';
const oauthManagers = new Map();
function writeOauthTokenInfo(account) {
    logger_1.logger.debug((0, lang_1.i18n)(`${i18nKey}.writeTokenInfo`, { portalId: account.accountId }));
    (0, config_1.updateConfigAccount)(account);
}
function getOauthManager(account) {
    if (!oauthManagers.has(account.accountId)) {
        oauthManagers.set(account.accountId, new OAuth2Manager_1.OAuth2Manager(account, () => writeOauthTokenInfo(account)));
    }
    return oauthManagers.get(account.accountId);
}
exports.getOauthManager = getOauthManager;
function addOauthToAccountConfig(oauth) {
    logger_1.logger.log((0, lang_1.i18n)(`${i18nKey}.addOauthToAccountConfig.init`));
    (0, config_1.updateConfigAccount)(oauth.account);
    logger_1.logger.success((0, lang_1.i18n)(`${i18nKey}.addOauthToAccountConfig.success`));
}
exports.addOauthToAccountConfig = addOauthToAccountConfig;
